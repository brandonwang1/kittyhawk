deploy_version: 0.1.21
applications:

  - name: backend
    image: pennlabs/penn-courses-backend
    secret: penn-courses
    replicas: 3
    cmd: ["celery", "worker", "-A", "PennCourses", "-Q", "alerts,celery", "-linfo"]
    ingress:
      hosts:
        - host: penncourseplan.com
          paths: ["/api", "/admin", "/accounts", "/assets"]
        - host: penncoursealert.com
          paths: ["/api", "/admin", "/accounts", "/assets", "/webhook"]
        - host: review.penncourses.org
          paths: ["/api", "/admin", "/accounts", "/assets"]
    extraEnv:
      - name: DJANGO_SETTINGS_MODULE
        value: PennCourses.settings.production
      - name: PORT
        value: 80

cronjobs:
  - name: load-courses
    schedule: "0 3 * * *"
    image: pennlabs/penn-courses-backend
    secret: penn-courses
    cmd: ["python", "manage.py", "registrarimport"]
  - name: report-stats
    schedule: "0 20 * * *"
    image: pennlabs/penn-courses-backend
    secret: penn-courses
    cmd: ["python", "manage.py", "alertstats", "1", "--slack"]